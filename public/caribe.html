<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="caribe.css"> </link>
<body>
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <script type="text/javascript">
    var width = 750,
    height = 550;

    var svg = d3.select("body").append("svg")
    		.attr("width", width)
        .attr("height", height)
				.attr("class", "root");

	d3.json("caribe.json", function(error, caribe) {
    	if (error) return console.error(error);

			console.log(caribe);

    var countries = topojson.feature(caribe, caribe.objects.countries);

		var hiddenCountries = ['COL', 'BRA', 'PRI', 'FRA', 'MEX', 'USA', 'ECU', 'PER'];

		var projection = d3.geo.mercator()
			.center([-68, 14])
			.rotate([4.4, 0])
			.scale(1000)
			.translate([width / 2, height / 2]);

    	var path = d3.geo.path()
    		.projection(projection);

    	svg.selectAll(".country")
    			.data(countries.features)
  		  .enter().append("path")
    			.attr("class", function(d) { return "country " + d.id; })
    			.attr("d", path)
					.classed("hidden", function(d) { return hiddenCountries.indexOf(d.id) >=0; });

			svg.append("path")
				.datum(topojson.mesh(caribe, caribe.objects.countries, function(a, b) { return a !== b; }))
				.attr("d", path)
				.attr("class", "border");

			svg.append("path")
					.datum(topojson.mesh(caribe, caribe.objects.countries, function(a, b) {
						return a === b && hiddenCountries.indexOf(a.id) >=0;
					}))
					.attr("d", path)
					.attr("class", "coast");

			/*svg.append("path")
				.datum(topojson.feature(caribe, caribe.objects.cities))
				.attr("d", path)
				.attr("class", "city");*/

			svg.selectAll(".country-label")
					.data(countries.features)
				.enter().append("text")
					.attr("class", function(d) { return "country-label " + d.id; })
					.attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
					.attr("dy", ".35em")
					.text(function(d) { return d.properties.name; })
					.style("text-anchor", function(d) {
						return ['KNA', 'VCT', 'SLV', 'DMA', 'GRD'].indexOf(d.id) >= 0 ? "end" :
									['ATG', 'DOM', 'BRB', 'BLZ', 'LCA', 'TTO', 'PRI'].indexOf(d.id) >= 0 ? "start" : "middle";
					});
		});

    </script>
</body>
