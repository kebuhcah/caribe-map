<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="caribe.css"> </link>
<body>
  <script src="lib/d3.v3.min.js" charset="utf-8"></script>
  <script src="lib/topojson.v1.min.js"></script>
  <script type="text/javascript">
    var width = 900,
    height = 640;

    var svg = d3.select("body").append("svg")
    		.attr("width", width)
        .attr("height", height)
				.attr("class", "root");

	d3.json("caribe.json", function(error, caribe) {
    	if (error) return console.error(error);

			console.log(caribe);

    var countries = topojson.feature(caribe, caribe.objects.countries);

		var hiddenCountries = ['COL', 'BRA', 'PRI', 'FRA', 'MEX', 'BRB', 'SLV',
		                       'USA', 'ECU', 'PER', 'PAN', 'CRI', 'TTO'];

		function isHiddenCountry(c) {
			return hiddenCountries.indexOf(c) >= 0;
		}

		var projection = d3.geo.mercator()
			.center([-73, 14])
			.scale(1200)
			.translate([width / 2, height / 2]);

    	var path = d3.geo.path()
    		.projection(projection);

    	svg.selectAll(".country")
    			.data(countries.features)
  		  .enter().append("path")
    			.attr("class", function(d) { return "country " + d.id; })
    			.attr("d", path)
					.classed("ghost", function(d) { return isHiddenCountry(d.id); });

			svg.append("path")
				.datum(topojson.mesh(caribe, caribe.objects.countries, function(a, b) {
					return a !== b && !(isHiddenCountry(a.id) && isHiddenCountry(b.id));
				}))
				.attr("d", path)
				.attr("class", "border");

			svg.append("path")
					.datum(topojson.mesh(caribe, caribe.objects.countries, function(a, b) {
						return a === b && isHiddenCountry(a.id)
							|| a !== b && isHiddenCountry(a.id) && isHiddenCountry(b.id);
					}))
					.attr("d", path)
					.attr("class", "ghost-border");

			/*svg.append("path")
				.datum(topojson.feature(caribe, caribe.objects.cities))
				.attr("d", path)
				.attr("class", "city");*/

			svg.selectAll(".country-label")
					.data(countries.features.filter(function(d) {
            return !isHiddenCountry(d.id);
          }))
				.enter().append("text")
					.attr("class", function(d) { return "country-label " + d.id; })
					.attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
					.attr("dy", ".35em")
          .attr("font-size", 12)
					.text(function(d) { return d.properties.name; })
					.style("text-anchor", function(d) {
						return ['KNA', 'VCT', 'DMA'].indexOf(d.id) >= 0 ? "end" :
									['ATG', 'DOM', 'BLZ', 'LCA', 'GRD'].indexOf(d.id) >= 0 ? "start" : "middle";
					});
		});

    </script>
</body>
